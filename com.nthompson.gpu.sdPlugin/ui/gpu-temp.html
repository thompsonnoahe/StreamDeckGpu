<!doctype html>
<html>
  <head lang="en">
    <title>GPU Metrics</title>
    <meta charset="utf-8" />
    <script src="https://sdpi-components.dev/releases/v3/sdpi-components.js"></script>
  </head>

  <body>
    <sdpi-item label="Device">
      <sdpi-select
        id="devices"
        label="Devices"
        placeholder="Select a device"
        setting="gpuId"
      >
      </sdpi-select>
    </sdpi-item>

    <sdpi-item label="Temperature Unit">
      <sdpi-radio
        id="temp"
        label="Temperature"
        placeholder="Select..."
        setting="temp"
      >
        <option value="celsius">Celsius</option>
        <option value="fahrenheit">Fahrenheit</option>
      </sdpi-radio>
    </sdpi-item>
    <sdpi-item>
      <sdpi-checkbox
        id="chartCheckbox"
        setting="enableChart"
        label="Enable chart?"
      ></sdpi-checkbox>
    </sdpi-item>
    <sdpi-item label="Chart Color">
      <sdpi-color class="control" setting="chartColor"></sdpi-color>
    </sdpi-item>
    <sdpi-item label="Minimum Temperature">
      <sdpi-textfield
        class="control"
        setting="minTemp"
        pattern="^(0|[1-9][0-9]*)$"
        placeholder="0"
        maxLength="3"
      >
      </sdpi-textfield>
    </sdpi-item>
    <sdpi-item label="Maximum Temperature">
      <sdpi-textfield
        class="control"
        setting="maxTemp"
        pattern="^(0|[1-9][0-9]*)$"
        placeholder="100"
        maxLength="3"
      >
      </sdpi-textfield>
    </sdpi-item>

    <script>
      const control = document
        .getElementById('chartCheckbox')
        .addEventListener('valuechange', e => {
          const controls = document.querySelectorAll('.control');
          console.log(controls);
          controls.forEach(c => {
            c.disabled = !e.target.value;
          });
        });

      const { streamDeckClient } = SDPIComponents;

      streamDeckClient.sendToPropertyInspector.subscribe(e => {
        const devices = document.getElementById('devices');

        if (e.payload.length == 0) {
          const option = document.createElement('option');
          option.value = undefined;
          option.text = 'No GPUs found';
          devices.appendChild(option);
        }

        for (const device of e.payload) {
          const option = document.createElement('option');
          option.value = device.value;
          option.text = device.title;
          devices.appendChild(option);
        }
      });
    </script>
  </body>
</html>
