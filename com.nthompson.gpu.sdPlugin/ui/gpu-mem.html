<!doctype html>
<html>
  <head lang="en">
    <title>GPU Metrics</title>
    <meta charset="utf-8" />
    <script src="https://sdpi-components.dev/releases/v3/sdpi-components.js"></script>
  </head>

  <body>
    <sdpi-item label="Device">
      <sdpi-select
        id="devices"
        label="Devices"
        placeholder="Select a device"
        setting="gpuId"
      >
      </sdpi-select>
    </sdpi-item>
    <sdpi-item>
      <sdpi-checkbox
        id="percentageControl"
        setting="showAsPercentage"
        label="Show as percentage"
      ></sdpi-checkbox>
    </sdpi-item>
    <sdpi-item>
      <sdpi-checkbox
        id="chartCheckbox"
        setting="enableChart"
        label="Enable chart"
      ></sdpi-checkbox>
    </sdpi-item>
    <sdpi-item label="Chart Color">
      <sdpi-color class="control" setting="chartColor"></sdpi-color>
    </sdpi-item>

    <script>
      const { streamDeckClient } = SDPIComponents;

      document
        .getElementById('chartCheckbox')
        .addEventListener('valuechange', e => {
          const controls = document.querySelectorAll('.control');
          controls.forEach(c => {
            c.disabled = !e.target.value;
          });
        });

      streamDeckClient.sendToPropertyInspector.subscribe(e => {
        const devices = document.getElementById('devices');

        if (e.payload.length == 0) {
          const option = document.createElement('option');
          option.value = undefined;
          option.text = 'No GPUs found';
          devices.appendChild(option);
        }

        for (const device of e.payload) {
          const option = document.createElement('option');
          option.value = device.value;
          option.text = device.title;
          devices.appendChild(option);
        }
      });
    </script>
  </body>
</html>
